<!-- èœå•ç®¡ç†é¡µ B-06 -->
<nav-bar
  title="èœå•ç®¡ç†"
  left-arrow="{{true}}"
  right-text="+ æ·»åŠ å•†å“"
  bind:right="onAddProduct"
/>

<view class="page-container">
  <!-- åˆ†ç±»ç®¡ç†å…¥å£ -->
  <view class="category-header">
    <text class="category-header__label">åˆ†ç±»ç®¡ç†</text>
    <text class="category-header__edit" bind:tap="onEditCategory">[ç¼–è¾‘åˆ†ç±»]</text>
  </view>

  <!-- åˆ†ç±»Tabæ¨ªå‘æ»šåŠ¨ -->
  <scroll-view
    class="category-tabs"
    scroll-x
    enable-flex
    enhanced
    show-scrollbar="{{false}}"
  >
    <view
      class="category-tab {{activeCategory === 'all' ? 'category-tab--active' : ''}}"
      bind:tap="onCategoryTap"
      data-id="all"
    >
      å…¨éƒ¨
    </view>
    <view
      wx:for="{{categories}}"
      wx:key="_id"
      class="category-tab {{activeCategory === item._id ? 'category-tab--active' : ''}}"
      bind:tap="onCategoryTap"
      data-id="{{item._id}}"
    >
      {{item.name}}
    </view>
  </scroll-view>

  <!-- å•†å“åˆ—è¡¨ -->
  <view class="product-list" wx:if="{{!loading && filteredProducts.length > 0}}">
    <view
      class="product-card {{!item.isOnSale ? 'product-card--off' : ''}}"
      wx:for="{{filteredProducts}}"
      wx:key="_id"
    >
      <!-- å•†å“ä¿¡æ¯åŒº -->
      <view class="product-info">
        <image
          class="product-info__image"
          src="{{item.imageUrl || '/images/default-product.png'}}"
          mode="aspectFill"
        />
        <view class="product-info__detail">
          <view class="product-info__row">
            <text class="product-info__name">{{item.name}}</text>
            <text class="product-info__price">Â¥{{item.priceYuan}}</text>
          </view>
          <text class="product-info__desc" wx:if="{{item.description}}">{{item.description}}</text>
          <view class="product-info__status">
            <text
              class="status-tag {{item.isOnSale ? 'status-tag--on' : 'status-tag--off'}}"
            >{{item.isOnSale ? 'ä¸Šæ¶ä¸­' : 'å·²ä¸‹æ¶'}}</text>
          </view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’®ç»„ -->
      <view class="product-actions">
        <view class="action-btn action-btn--edit" bind:tap="onEditProduct" data-id="{{item._id}}">ç¼–è¾‘</view>
        <view class="action-btn action-btn--spec" bind:tap="onSpecConfig" data-id="{{item._id}}">è§„æ ¼</view>
        <view
          class="action-btn {{item.isOnSale ? 'action-btn--off-sale' : 'action-btn--on-sale'}}"
          bind:tap="onToggleSale"
          data-id="{{item._id}}"
          data-status="{{item.isOnSale}}"
        >{{item.isOnSale ? 'ä¸‹æ¶' : 'ä¸Šæ¶'}}</view>
        <view class="action-btn action-btn--delete" bind:tap="onDeleteProduct" data-id="{{item._id}}" data-name="{{item.name}}">åˆ é™¤</view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading-center" wx:if="{{loading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <empty-state
    wx:if="{{!loading && filteredProducts.length === 0}}"
    icon="ğŸ“‹"
    text="æš‚æ— å•†å“"
    description="ç‚¹å‡»å³ä¸Šè§’ã€Œ+ æ·»åŠ å•†å“ã€å¼€å§‹åˆ›å»º"
    button-text="æ·»åŠ å•†å“"
    bind:action="onAddProduct"
  />
</view>

<toast id="toast" />
