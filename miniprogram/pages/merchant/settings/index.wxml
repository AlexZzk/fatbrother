<nav-bar title="åº—é“ºè®¾ç½®" left-arrow="{{true}}" />

<view class="page-container">
  <block wx:if="{{!loading && merchantInfo}}">
    <!-- åŸºç¡€ä¿¡æ¯ -->
    <view class="section">
      <view class="section-title">åŸºç¡€ä¿¡æ¯</view>
      <view class="section-card">
        <view class="avatar-row" bindtap="onChangeAvatar">
          <text class="avatar-label">åº—é“ºå¤´å›¾</text>
          <view class="avatar-right">
            <image
              wx:if="{{merchantInfo.shop_avatar}}"
              class="avatar-img"
              src="{{merchantInfo.shop_avatar}}"
              mode="aspectFill"
            />
            <view wx:else class="avatar-placeholder">
              <text>ç‚¹å‡»ä¸Šä¼ </text>
            </view>
            <text class="avatar-arrow">></text>
          </view>
        </view>
        <!-- å®£ä¼ å›¾ -->
        <view class="avatar-row" bindtap="onChangeBanner">
          <text class="avatar-label">åº—é“ºå®£ä¼ å›¾</text>
          <view class="avatar-right">
            <image
              wx:if="{{merchantInfo.shop_banner}}"
              class="banner-img"
              src="{{merchantInfo.shop_banner}}"
              mode="aspectFill"
            />
            <view wx:else class="banner-placeholder">
              <text>ç‚¹å‡»ä¸Šä¼ </text>
            </view>
            <text class="avatar-arrow">></text>
          </view>
        </view>
        <cell
          title="åº—é“ºåç§°"
          value="{{merchantInfo.shop_name}}"
          arrow
          data-field="shop_name"
          bindclick="onEditField"
        />
        <cell
          title="åº—é“ºå…¬å‘Š"
          value="{{merchantInfo.announcement || 'æœªè®¾ç½®'}}"
          arrow
          data-field="announcement"
          bindclick="onEditField"
        />
        <cell
          title="è”ç³»ç”µè¯"
          value="{{merchantInfo.contact_phone}}"
          arrow
          data-field="contact_phone"
          bindclick="onEditField"
        />
      </view>
    </view>

    <!-- æ¨å¹¿ -->
    <view class="section">
      <view class="section-title">æ¨å¹¿</view>
      <view class="section-card">
        <cell
          icon="ğŸŸ"
          title="æˆ‘çš„é‚€è¯·ç "
          value="{{merchantInfo.invite_code}}"
          arrow
          bindclick="onInviteTap"
        />
      </view>
    </view>

    <!-- è´¹ç”¨è®¾ç½® -->
    <view class="section">
      <view class="section-title">è´¹ç”¨è®¾ç½®</view>
      <view class="section-card">
        <cell
          title="èµ·é€ä»·"
          value="{{feeLabels.minOrder}}"
          arrow
          data-field="min_order_amount"
          bindclick="onEditField"
        />
        <cell
          title="åŒ…è£…è´¹"
          value="{{feeLabels.packing}}"
          arrow
          data-field="packing_fee"
          bindclick="onEditField"
        />
        <cell
          title="é…é€è´¹è§„åˆ™"
          value="{{feeLabels.delivery}}"
          arrow
          bindclick="onDeliverySettingsTap"
        />
      </view>
    </view>

    <!-- è¥é”€ -->
    <view class="section">
      <view class="section-title">è¥é”€æ´»åŠ¨</view>
      <view class="section-card">
        <cell
          icon="ğŸ"
          title="æ»¡å‡ä¿ƒé”€"
          value="ç®¡ç†æ»¡å‡æ´»åŠ¨"
          arrow
          bindclick="onPromotionsTap"
        />
      </view>
    </view>
  </block>

  <block wx:elif="{{loading}}">
    <view class="loading-center"><text>åŠ è½½ä¸­...</text></view>
  </block>
</view>

<!-- ç¼–è¾‘å¼¹çª— -->
<view wx:if="{{editingField}}" class="edit-mask" bindtap="onEditCancel">
  <view class="edit-popup" catchtap="">
    <view class="edit-header">
      <text class="edit-title">ç¼–è¾‘{{editingField === 'shop_name' ? 'åº—é“ºåç§°' : editingField === 'announcement' ? 'åº—é“ºå…¬å‘Š' : editingField === 'min_order_amount' ? 'èµ·é€ä»·' : editingField === 'packing_fee' ? 'åŒ…è£…è´¹' : 'è”ç³»ç”µè¯'}}</text>
    </view>
    <view wx:if="{{editingNumeric}}" class="edit-amount-row">
      <text class="edit-currency">Â¥</text>
      <input
        class="edit-input edit-input--amount"
        type="digit"
        value="{{editValue}}"
        placeholder="è¾“å…¥é‡‘é¢ï¼ˆå…ƒï¼‰"
        focus="{{true}}"
        bindinput="onEditInput"
        bindconfirm="onEditConfirm"
      />
    </view>
    <input
      wx:elif="{{editingField !== 'announcement'}}"
      class="edit-input"
      value="{{editValue}}"
      focus="{{true}}"
      bindinput="onEditInput"
      bindconfirm="onEditConfirm"
    />
    <textarea
      wx:else
      class="edit-textarea"
      value="{{editValue}}"
      focus="{{true}}"
      bindinput="onEditInput"
      maxlength="100"
      auto-height
    />
    <view class="edit-hint" wx:if="{{editingField === 'min_order_amount'}}">
      <text>è®¾ä¸º0è¡¨ç¤ºæ— èµ·é€é™åˆ¶</text>
    </view>
    <view class="edit-actions">
      <button class="edit-btn edit-btn--cancel" bindtap="onEditCancel">å–æ¶ˆ</button>
      <button class="edit-btn edit-btn--confirm" bindtap="onEditConfirm">ç¡®å®š</button>
    </view>
  </view>
</view>

<toast id="toast" />
