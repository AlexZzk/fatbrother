<nav-bar title="éª‘æ‰‹æ¥å•" left-arrow="{{true}}" />

<view class="page-container">
  <!-- Tabs -->
  <view class="tabs">
    <view
      class="tab {{activeTab === 0 ? 'tab--active' : ''}}"
      data-index="0"
      bindtap="onTabTap"
    >æŠ¢å•å¤§å…</view>
    <view
      class="tab {{activeTab === 1 ? 'tab--active' : ''}}"
      data-index="1"
      bindtap="onTabTap"
    >æˆ‘çš„é…é€</view>
  </view>

  <!-- æŠ¢å•å¤§å… -->
  <block wx:if="{{activeTab === 0}}">
    <!-- ä¸Šçº¿çŠ¶æ€æç¤º -->
    <view wx:if="{{!isOnline}}" class="offline-banner">
      <text class="offline-text">æ‚¨å½“å‰å¤„äºç¦»çº¿çŠ¶æ€ï¼Œæ— æ³•æ¥å•</text>
      <text class="offline-go" bindtap="onGoStatus">å»ä¸Šçº¿</text>
    </view>

    <view wx:if="{{loading}}" class="loading-center"><text>åŠ è½½ä¸­...</text></view>
    <view wx:elif="{{dispatchingOrders.length === 0}}" class="empty-wrap">
      <text class="empty-text">æš‚æ— å¾…é…é€è®¢å•</text>
      <text class="empty-sub">ä¸‹æ‹‰åˆ·æ–°é‡è¯•</text>
    </view>
    <view wx:else>
      <view
        class="order-card"
        wx:for="{{dispatchingOrders}}"
        wx:key="_id"
      >
        <view class="order-header">
          <text class="merchant-name">{{item.merchant_name}}</text>
          <view class="order-fee">
            <text class="fee-label">é…é€è´¹</text>
            <price value="{{item.delivery_fee_actual}}" />
          </view>
        </view>

        <view class="order-items">
          <text class="items-text">{{item._itemSummary}}</text>
        </view>

        <view class="order-addr-row" wx:if="{{item.delivery_address}}">
          <text class="addr-icon">ğŸ“</text>
          <text class="addr-text">{{item.delivery_address.address}}{{item.delivery_address.detail ? ' ' + item.delivery_address.detail : ''}}</text>
        </view>

        <view class="order-footer">
          <text class="order-time">{{item._createTime}}</text>
          <view
            class="accept-btn {{!isOnline ? 'accept-btn--disabled' : ''}}"
            data-id="{{item._id}}"
            bindtap="onAccept"
          >ç«‹å³æ¥å•</view>
        </view>
      </view>
    </view>
  </block>

  <!-- æˆ‘çš„é…é€ -->
  <block wx:if="{{activeTab === 1}}">
    <view wx:if="{{myLoading}}" class="loading-center"><text>åŠ è½½ä¸­...</text></view>
    <view wx:elif="{{myOrders.length === 0}}" class="empty-wrap">
      <text class="empty-text">æš‚æ— é…é€è®°å½•</text>
    </view>
    <view wx:else>
      <view
        class="order-card"
        wx:for="{{myOrders}}"
        wx:key="_id"
        data-id="{{item._id}}"
        bindtap="onOrderTap"
      >
        <view class="order-header">
          <text class="merchant-name">{{item.merchant_name}}</text>
          <view class="status-tag status-tag--{{item.status}}">
            <text>{{item._statusText}}</text>
          </view>
        </view>

        <view class="order-addr-row" wx:if="{{item.delivery_address}}">
          <text class="addr-icon">ğŸ“</text>
          <text class="addr-text">{{item.delivery_address.address}}{{item.delivery_address.detail ? ' ' + item.delivery_address.detail : ''}}</text>
        </view>

        <view class="order-footer">
          <text class="order-time">{{item._createTime}}</text>
          <view class="order-fee-small">
            <text>é…é€è´¹ </text>
            <price value="{{item.delivery_fee_actual}}" />
          </view>
        </view>

        <!-- é…é€ä¸­ï¼šæ˜¾ç¤ºå–é¤ç  -->
        <view wx:if="{{item.status === 'DELIVERING' && item.pickup_code}}" class="pickup-row">
          <text class="pickup-label">å–é¤ç ï¼ˆå‡ºç¤ºç»™å•†å®¶ï¼‰</text>
          <text class="pickup-code">{{item.pickup_code}}</text>
        </view>
      </view>
    </view>
  </block>
</view>
