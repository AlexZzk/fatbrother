<nav-bar title="æˆ‘çš„ä¼˜æƒ åˆ¸" left-arrow="{{true}}" />

<view class="page-container">
  <!-- é¢†åˆ¸å…¥å£ -->
  <view class="activity-banner" bindtap="onShowActivities">
    <text class="activity-banner-icon">ğŸ</text>
    <text class="activity-banner-text">é¢†å–çº¢åŒ… / ä¼˜æƒ åˆ¸</text>
    <text class="activity-banner-arrow">></text>
  </view>

  <!-- Tab åˆ‡æ¢ -->
  <view class="tabs">
    <view
      class="tab-item {{activeTab === index ? 'tab-item--active' : ''}}"
      wx:for="{{tabs}}"
      wx:key="index"
      bindtap="onTabChange"
      data-index="{{index}}"
    >
      {{item}}
    </view>
  </view>

  <!-- åˆ¸åˆ—è¡¨ -->
  <block wx:if="{{!loading}}">
    <view wx:if="{{coupons.length > 0}}" class="coupon-list">
      <view
        class="coupon-item {{item.status !== 'unused' ? 'coupon-item--used' : ''}}"
        wx:for="{{coupons}}"
        wx:key="_id"
      >
        <view class="coupon-amount-block">
          <text class="coupon-yuan">Â¥</text>
          <text class="coupon-value">{{item.amountLabel}}</text>
        </view>
        <view class="coupon-info">
          <text class="coupon-name">{{item.name}}</text>
          <text class="coupon-condition">{{item.conditionLabel}}</text>
          <text class="coupon-expire" wx:if="{{item.expired_at}}">
            æœ‰æ•ˆæœŸè‡³ {{item.expired_at}}
          </text>
        </view>
        <view class="coupon-status">
          <text wx:if="{{item.status === 'used'}}" class="status-text status-text--used">å·²ä½¿ç”¨</text>
          <text wx:elif="{{item.status === 'expired' || item.is_expired}}" class="status-text status-text--expired">å·²è¿‡æœŸ</text>
          <text wx:else class="status-text status-text--unused">å¯ä½¿ç”¨</text>
        </view>
      </view>
    </view>

    <view wx:else class="empty-state">
      <text class="empty-icon">ğŸŸ</text>
      <text class="empty-text">æš‚æ— {{tabs[activeTab]}}çš„ä¼˜æƒ åˆ¸</text>
      <text class="empty-hint" wx:if="{{activeTab === 0}}">ç‚¹å‡»ä¸Šæ–¹é¢†å–çº¢åŒ…ä¼˜æƒ </text>
    </view>
  </block>

  <view wx:elif="{{loading}}" class="loading-center">
    <text>åŠ è½½ä¸­...</text>
  </view>
</view>

<!-- é¢†åˆ¸æ´»åŠ¨å¼¹çª— -->
<view wx:if="{{showActivities}}" class="activity-mask" bindtap="onHideActivities">
  <view class="activity-popup" catchtap="">
    <view class="activity-header">
      <text class="activity-title">çº¢åŒ…é¢†å–</text>
      <text class="activity-close" bindtap="onHideActivities">âœ•</text>
    </view>

    <view wx:if="{{activities.length > 0}}" class="activity-list">
      <view class="activity-item" wx:for="{{activities}}" wx:key="_id">
        <view class="activity-left">
          <text class="activity-amount">Â¥{{item.amountLabel}}</text>
          <text class="activity-condition">{{item.conditionLabel}}</text>
        </view>
        <view class="activity-right">
          <text class="activity-name">{{item.name}}</text>
          <text class="activity-desc" wx:if="{{item.description}}">{{item.description}}</text>
          <view
            class="claim-btn {{(item.is_claimed || item.is_full) ? 'claim-btn--disabled' : ''}}"
            bindtap="onClaimCoupon"
            data-id="{{item._id}}"
          >
            {{item.is_claimed ? 'å·²é¢†å–' : item.is_full ? 'å·²æŠ¢å®Œ' : 'ç«‹å³é¢†å–'}}
          </view>
        </view>
      </view>
    </view>

    <view wx:else class="activity-empty">
      <text>æš‚æ— è¿›è¡Œä¸­çš„æ´»åŠ¨</text>
    </view>
  </view>
</view>
